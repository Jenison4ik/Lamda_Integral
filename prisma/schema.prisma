// =======================
// Datasource & Generator
// =======================

datasource db {
  provider = "sqlite"
}

generator client {
  provider = "prisma-client-js"
}

// =======================
// Models
// =======================

model User {
  id          Int           @id @default(autoincrement())
  telegramId  BigInt        @unique
  username    String?
  lastSeen    DateTime?
  createdAt   DateTime      @default(now())

  sessions    QuizSession[]

  @@map("users")
}

model QuizSession {
  id              Int              @id @default(autoincrement())
  userId          Int
  difficulty      String
  totalQuestions  Int
  correctAnswers  Int              @default(0)
  score           Int              @default(0)

  startedAt       DateTime         @default(now())
  finishedAt      DateTime?

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  answers         SessionAnswer[]

  @@map("quiz_sessions")
}

model Question {
  id            Int              @id @default(autoincrement())
  difficulty    String
  content       Json
  correctIndex  Int
  createdAt     DateTime         @default(now())

  answers       SessionAnswer[]

  @@map("questions")
}

model SessionAnswer {
  id           Int          @id @default(autoincrement())
  sessionId    Int
  questionId   Int
  chosenAnswer Int
  isCorrect    Boolean
  answeredAt   DateTime     @default(now())

  session      QuizSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  question     Question    @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, questionId])
  @@map("session_answers")
}
